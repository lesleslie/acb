---
id: 01K6FSH1C9B8S3VAPTVCBG9DBN
---
______________________________________________________________________

## id: 01K6FSG2FAN21SGCNRCGEJ5GGS

______________________________________________________________________

## id: 01K6FSAQ47K2JNB8QKY8TF22CD

______________________________________________________________________

## id: 01K6FRWD77M1MSKK03DA9HG68Y

______________________________________________________________________

## id: 01K6FRSPJCKNQNGR47RS23X7TK

______________________________________________________________________

## id: 01K6FRKT9QXWM9ZSS2V32RJ8SH

______________________________________________________________________

## id: 01K6FRJ50YWCED6CPHRSFKD2ZZ

______________________________________________________________________

## id: 01K6FRDWXWCTYYVB51RRADCEPE

______________________________________________________________________

## id: 01K6FQVWYF7F7WD4ZYYM4S6T3Z

______________________________________________________________________

## id: 01K6FQNWEPYWYRHMW9T6W9FVYC

______________________________________________________________________

## id: 01K6FQ9BZK69788PYF17V2EP17

______________________________________________________________________

## id: 01K6FQ0419GDD0432AA14X6GB4

______________________________________________________________________

## id: 01K6FPY7D124V0XDZSVS91S3XA

______________________________________________________________________

## id: 01K6FPVVER3FNQSP6XB1BRP3J9

______________________________________________________________________

## id: 01K6FP8ZQ6YBYST9E5J3MHD723

______________________________________________________________________

## id: 01K6FP1Y39JJTK8XECJAPK09P9

______________________________________________________________________

## id: 01K6FP05ZEVWJWV8N6YJT8BJXM

______________________________________________________________________

## id: 01K6FNY5CFDHJJA73E032AZ5EY

______________________________________________________________________

## id: 01K6FND44Q03MBBQG610HS1EZF

______________________________________________________________________

## id: 01K6FN9BKMHMGM4XF9MAHXHAQP

______________________________________________________________________

## id: 01K6FM8R68W05DKXK1J676N2FA

______________________________________________________________________

## id: 01K6FM4E1QZQJKXQWME4H077WW

______________________________________________________________________

## id: 01K6FM32EWNJWVM8B2ZXSWTFHN

______________________________________________________________________

## id: 01K6FKYV5FMWSVQN94HJW3KB8E

______________________________________________________________________

## id: 01K6FKXE108M4JJPWVE0QSZQ37

______________________________________________________________________

## id: 01K6FD9HV17AS9FZM6P7QNRJKF

______________________________________________________________________

## id: 01K6FCP9BV56GS3WM4P94KYF4W

______________________________________________________________________

## id: 01K6FBZB267QH3DW08E4YKD1TS

______________________________________________________________________

## id: 01K6FBRSBECWM2XR3FE4B1XGM6

______________________________________________________________________

## id: 01K6FBJHVKTQJ0HHPSA7HE3NHX

______________________________________________________________________

## id: 01K6FB8KMXSXRBVGS5AJCCV0XN

______________________________________________________________________

## id: 01K6F9NY9MS7VKN66CZPD9NKD1

______________________________________________________________________

## id: 01K6F9JY0QAYTB7JND02J5J7ZP

______________________________________________________________________

## id: 01K6F9HZNEED41BF3RQ0VDWPP1

______________________________________________________________________

## id: 01K6F9FFT3PZ977X48M5694191

______________________________________________________________________

## id: 01K6F9EJ7KMW0GRD1VNTA2CS4C

______________________________________________________________________

## id: 01K6F8HG8JWCRPTYFD24CJKFCW

______________________________________________________________________

## id: 01K6F85SQRD86EWYH8YC9M037Q

______________________________________________________________________

## id: 01K6F6ZGMTE8BMT1H9M58CM5X4

______________________________________________________________________

## id: 01K6F6Y5Z4MDAKGBKB83S1MNFV

______________________________________________________________________

## id: 01K6F0QF7JXRNXT4H47ANJGJBP

______________________________________________________________________

## id: 01K6F060KHKDQWMF8HDV8600JR

______________________________________________________________________

## id: 01K6EZZRWXND4YYK6G2EZJMVMB

______________________________________________________________________

## id: 01K6EZZ4GG2GP5KKSRA0RSWF14

______________________________________________________________________

## id: 01K6EZMWS1GVJ7BY8B6ZTTB83C

______________________________________________________________________

## id: 01K6EZM2M6H2GPD540DJW7A8HK

______________________________________________________________________

## id: 01K6EZ6RNQ83DK51MK43A95GJ8

______________________________________________________________________

## id: 01K6EZ64F4DQZ7FER02G5BNVVG

______________________________________________________________________

## id: 01K6EZ12BDS63DVX7Q38DN4DE6

______________________________________________________________________

## id: 01K6EZ05RDAWY4ESG2E5R5FTZJ

______________________________________________________________________

## id: 01K6EYXYWCPRJM2JAFA7JF67PV

______________________________________________________________________

## id: 01K6EYX7GDR26K8P6PK219MSQM

______________________________________________________________________

## id: 01K6EXJR34MPQHBTHNDCFC1WDR

______________________________________________________________________

## id: 01K6EXHQE3C4M59SCV42KH3C55

______________________________________________________________________

## id: 01K6EXCM9ZW6EZS0406F0FZJ6C

______________________________________________________________________

## id: 01K6EXBRHCCYG6VE9RFP4C3PGY

______________________________________________________________________

## id: 01K6EWFHM8BQZXZJY0FB9SXD07

______________________________________________________________________

## id: 01K6EWEPZNX3REEWGDBRNXB60N

______________________________________________________________________

## id: 01K6ETPQEFCYZDP6BQQ5V3Y4T8

______________________________________________________________________

## id: 01K6ETP2TKXQHE5VXMQT9VQ048

______________________________________________________________________

## id: 01K6ETJBBQEH32X9WDNZGKWMA3

______________________________________________________________________

## id: 01K6ETHJZR7B7HJN1WJTC6T74S

______________________________________________________________________

## id: 01K6ESWKWT4RK7RPH9WVKRZ1B6

______________________________________________________________________

## id: 01K6ESVYS5CKGBR4A92D1GS2YR

______________________________________________________________________

## id: 01K6ESP2F709QJDCBE6SJ0P90A

______________________________________________________________________

## id: 01K6ESNDYPEYA3EQKQSTY9AP8F

______________________________________________________________________

## id: 01K6ESM0CC8TSZ0EBXEZZ360ZQ

______________________________________________________________________

## id: 01K6ESK96956C802X2477WGMJ1

______________________________________________________________________

## id: 01K6ESHF7YZGC1JG3V5YE66E29

______________________________________________________________________

## id: 01K6ESGVNP9H4JV1Y36Z271M3D

______________________________________________________________________

## id: 01K6EN5R2TR3RGVAKKQQX55Z9M

______________________________________________________________________

## id: 01K6EN4Z2ZTXH1K69KRNNXG8G3

______________________________________________________________________

## id: 01K6EMS4GSGJPPD74YQGNHF0VK

______________________________________________________________________

## id: 01K6EMRBXDXFNMWZQ980ZXDEQ4

______________________________________________________________________

## id: 01K6EGN78BGCBJFSKW0K9S5VXJ

# API Gateway Adapter

Comprehensive API Gateway implementation for ACB framework providing authentication, rate limiting, usage tracking, and request/response validation.

## Features

- **Authentication**: JWT, API key, and OAuth2 support
- **Rate Limiting**: Token bucket and sliding window algorithms
- **Usage Tracking**: Request metrics, quota management, and analytics
- **Middleware Chain**: CORS, security headers, validation, and logging
- **Request/Response Validation**: Pydantic schema validation
- **Analytics**: Endpoint and user usage analytics

## Quick Start

```python
from acb.adapters.gateway import APIGateway, GatewaySettings, GatewayConfig

# Configure gateway
config = GatewayConfig(
    auth_enabled=True,
    rate_limiting_enabled=True,
    usage_tracking_enabled=True,
    cors_enabled=True,
)

settings = GatewaySettings(gateway_config=config)

# Create and initialize gateway
gateway = APIGateway(settings)
await gateway.initialize()

# Add API key for authentication
await gateway.add_api_key("my-secret-key", "user123", ["read", "write"])

# Create user quota
await gateway.create_user_quota("user123", requests_per_hour=500)

# Handle requests
response = await gateway.handle_request(
    method="POST",
    path="/api/users",
    headers={"Authorization": "Bearer my-secret-key"},
    body={"name": "John Doe"},
    required_scopes=["write"],
)

print(f"Status: {response.status}")
print(f"Body: {response.body}")
```

## Configuration

### Basic Configuration

```yaml
# settings/gateway.yml
enabled: true
host: "0.0.0.0"
port: 8080
debug: false

# CORS settings
cors_enabled: true
cors_origins: ["*"]
cors_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]

# Rate limiting
rate_limiting_enabled: true
default_rate_limit: 100  # requests per minute
rate_limit_window_seconds: 60

# Authentication
auth_enabled: true
auth_providers: ["jwt", "api_key"]
jwt_secret: "your-secret-key"
jwt_algorithm: "HS256"

# Usage tracking
usage_tracking_enabled: true
usage_analytics_enabled: true

# Validation
validation_enabled: true
strict_validation: false
```

## Authentication

### JWT Authentication

```python
from acb.adapters.gateway.auth import JWTAuthProvider

# Configure JWT in settings
config = GatewayConfig(jwt_secret="your-secret-key", jwt_algorithm="HS256")

# Use JWT token in requests
headers = {"Authorization": "Bearer your-jwt-token"}
```

### API Key Authentication

```python
# Add API keys
await gateway.add_api_key("api-key-123", "user456", ["read"])

# Use API key in requests
headers = {"Authorization": "ApiKey api-key-123"}
```

## Rate Limiting

### Token Bucket Algorithm

```python
from acb.adapters.gateway.rate_limit import RateLimitConfig, TokenBucketLimiter

config = RateLimitConfig(
    requests_per_window=100, window_seconds=60, burst_size=10, replenish_rate=1.0
)

limiter = TokenBucketLimiter(config)
result = await limiter.check_rate_limit("user123")
```

### Sliding Window Algorithm

```python
from acb.adapters.gateway.rate_limit import SlidingWindowLimiter

limiter = SlidingWindowLimiter(config)
result = await limiter.check_rate_limit("user123")
```

## Usage Tracking and Analytics

### Track Usage

```python
from acb.adapters.gateway.usage import UsageTracker

tracker = UsageTracker()
await tracker.initialize()

# Usage is tracked automatically for authenticated requests
await tracker.record_request(
    user_id="user123",
    endpoint="/api/users",
    method="GET",
    response_status=200,
    response_time_ms=150.5,
)
```

### Get Analytics

```python
# Get endpoint analytics
analytics = await gateway.get_usage_analytics(time_range_hours=24)
print(analytics["endpoints"])
print(analytics["users"])

# Get user-specific stats
user_stats = await gateway.get_user_usage_stats("user123")
print(f"Daily requests: {user_stats['daily_requests']}")
print(f"Remaining quota: {user_stats['remaining']['daily']}")
```

### Quota Management

```python
# Set custom quota for a user
await gateway.create_user_quota(
    user_id="premium_user",
    requests_per_hour=2000,
    requests_per_day=50000,
    requests_per_month=1000000,
    bytes_per_day=100 * 1024 * 1024,  # 100MB
)
```

## Middleware

### Custom Middleware

```python
from acb.adapters.gateway.middleware import MiddlewareBase


class CustomMiddleware(MiddlewareBase):
    async def process_request(self, request):
        # Add custom request processing
        request["custom_header"] = "processed"
        return request

    async def process_response(self, response):
        # Add custom response processing
        response["headers"]["X-Custom"] = "processed"
        return response


# Add to gateway
gateway.processor.middleware_chain.add_middleware(CustomMiddleware())
```

### Request Validation

```python
from pydantic import BaseModel
from acb.adapters.gateway.middleware import ValidationMiddleware


class UserCreateSchema(BaseModel):
    name: str
    email: str
    age: int


# Register schema for validation
validation_middleware = gateway.processor.middleware_chain.get_middleware_by_type(
    ValidationMiddleware
)
validation_middleware.register_schema("/api/users", "POST", UserCreateSchema)
```

## Health Monitoring

```python
# Check gateway health
health = await gateway.health_check()
print(f"Status: {health['status']}")
print(f"Components: {health['components']}")
print(f"Uptime: {health['uptime_seconds']} seconds")

# Check individual component health
auth_health = await gateway.processor.auth_middleware.health_check()
rate_limit_health = await gateway.processor.rate_limit_middleware.health_check()
```

## Integration with ACB

```python
from acb.depends import depends
from acb.adapters import import_adapter

# Register gateway with dependency injection
Gateway = import_adapter("gateway")
gateway = Gateway()
await gateway.initialize()

depends.set(Gateway, gateway)


# Use in other components
@depends.inject
async def my_service(gateway: Gateway = depends()):
    response = await gateway.handle_request("GET", "/api/health")
    return response
```

## Security Features

- **CORS Support**: Configurable cross-origin resource sharing
- **Security Headers**: Automatic security headers (HSTS, XSS protection, etc.)
- **Request Validation**: Schema-based request validation
- **Rate Limiting**: Multiple algorithms to prevent abuse
- **Authentication**: Multiple auth providers with scope validation
- **Usage Quotas**: Prevent resource abuse with quota enforcement

## Performance

- **Async Operations**: Full async/await support
- **Connection Pooling**: Efficient resource management
- **Memory Efficient**: Sliding windows and LRU caches
- **Metrics Collection**: Built-in performance monitoring
- **Background Processing**: Non-blocking analytics and cleanup

## Error Handling

The gateway provides comprehensive error handling with appropriate HTTP status codes:

- `400`: Bad Request (validation errors)
- `401`: Unauthorized (authentication failed)
- `402`: Payment Required (quota exceeded)
- `429`: Too Many Requests (rate limited)
- `500`: Internal Server Error (gateway errors)

## Module Metadata

The gateway adapter includes proper ACB metadata for discovery:

```python
MODULE_METADATA = AdapterMetadata(
    name="API Gateway",
    category="gateway",
    provider="acb",
    version="1.0.0",
    capabilities=[
        AdapterCapability.ASYNC_OPERATIONS,
        AdapterCapability.AUTHENTICATION,
        AdapterCapability.RATE_LIMITING,
        AdapterCapability.MONITORING,
        AdapterCapability.VALIDATION,
    ],
    required_packages=["pyjwt>=2.0.0", "pydantic>=2.0.0"],
)
```
